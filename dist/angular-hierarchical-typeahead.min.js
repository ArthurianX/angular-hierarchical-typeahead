"use strict";angular.module("keyboard.focus",[]),angular.module("keyboard",["keyboard.focus"]),angular.module("keyboard").constant("undefined"),angular.module("keyboard").factory("KbContainerController",["undefined","$log",function(a,b){function c(b){this.identifier="[kb-container]",this.ngModel=a,this.selected=[],this.multiple=!1,this.cyclic=!1,this.active=a,this._element=b[0]}return c.$inject=["$element"],angular.extend(c.prototype,{initialize:function(a){this.multiple=angular.isDefined(a.attrs.multiple),this.cyclic=angular.isDefined(a.attrs.kbCyclic),angular.extend(this,a),this.ngModel&&(this.ngModel.$render=function(){this.multiple?(this.selected=this.ngModel.$viewValue,angular.isArray(this.selected)===!1&&(angular.isDefined(this.selected)&&b.error(this.identifier,"ng-model(multiple) must be an array, got:",this.selected),this.selected=[])):this.selected[0]=this.ngModel.$viewValue;for(var a in this.selected){var c=this._locate(this.selected[a]);if(c){this.active=c;break}}}.bind(this))},select:function(a){this.ngModel&&(this.multiple?this.isSelected(a)===!1&&(this.selected.push(a),this.ngModel.$setViewValue(this.selected)):(this.selected[0]=a,this.ngModel.$setViewValue(a)))},deselect:function(b){if(this.ngModel){var c=this.selected.indexOf(b);-1!==c&&(this.selected.splice(c,1),this.multiple?this.ngModel.$setViewValue(this.selected):this.ngModel.$setViewValue(a))}},toggle:function(a){this.isSelected(a)?this.deselect(a):this.select(a)},isSelected:function(a){return-1!==this.selected.indexOf(a)},previous:function(){var a=this._getSiblingItems(this.active).previous;return!!a&&(this.active=a,!0)},next:function d(){var d=this._getSiblingItems(this.active).next;return!!d&&(this.active=d,!0)},activate:function(a,c){return b.$error(this.identifier,"activate() is not implemented"),!1},invoke:function(a){return b.$error(this.identifier,"invoke() is not implemented"),!1},_locate:function(a){for(var b=this._element.querySelectorAll("[kb-item]"),c=0;c<b.length;c++){var d=angular.element(b.item(c)).controller("kbItem");if(d.model===a)return d}},_getSiblingItems:function(a){for(var b=a.element[0],c=this._element.querySelectorAll("[kb-item]"),d=0;d<c.length;d++){var e=c.item(d);if(e===b){var f={};return 0!==d&&(f.previous=angular.element(c.item(d-1)).controller("kbItem")),d<c.length-1&&(f.next=angular.element(c.item(d+1)).controller("kbItem")),f}}return{}},_first:function(){var a=this._element.querySelector("[kb-item]");return a?angular.element(a).controller("kbItem"):void 0},_last:function(){var a=this._element.querySelectorAll("[kb-item]");return a.length?angular.element(a[a.length-1]).controller("kbItem"):void 0}}),c}]),angular.module("keyboard").factory("KbItemController",["kbScroll","undefined",function(a,b){function c(a){this.model=b,this.element=a}return c.$inject=["$element"],c}]),angular.module("keyboard.focus").directive("kbFocus",["kbFocus","$log",function(a,b){return function(a,b,c){a.$watch(c.kbAutofocus,function(a){b.prop("autofocus",!!a)})}}]),angular.module("keyboard.focus").directive("kbFocus",["kbFocus","$log",function(a,b){return function(c,d,e){c.$watch(a.get,function(a){a===e.kbFocus&&(""===a?b.error("[kb-focus] Invalid label in",d[0]):(d[0].focus(),document.activeElement!==d[0]&&setTimeout(function(){d[0].focus()})))}),d.on("focus",function(){a(e.kbFocus),c.$root.$$phase||c.$apply()}),d.on("blur",function(){a.get()===e.kbFocus&&(a.reset(),c.$root.$$phase||c.$apply())})}}]),angular.module("keyboard").directive("kbItem",["KbItemController","$animate","$log",function(a,b,c){return{controller:a,require:["kbItem","?^kbList","?^kbSelect"],link:function(a,d,e,f){function g(a,b,c){return"left"===a&&c.left<b.left?b.left-c.left:"up"===a&&c.top<b.top?b.top-c.top:"right"===a&&c.left>b.left?c.left-b.left:"down"===a&&c.top>b.top?c.top-b.top:0}for(var h=f[0],i=f[1],j="A"===d[0].tagName||"BUTTON"===d[0].tagName||"AREA"===d[0].tagName,k=1;k<f.length;k++)f[k]&&(i=f[k]);if(!i)return void c.error("Controller 'kbList' or 'kbSelect', required by directive 'kbItem', can't be found!");var l=e.kbSelectedClass||"kb-selected",m=e.kbActiveClass||"kb-active";h.model=a.$eval(e.kbItem),a.$watch(e.kbItem,function(a){h.model=a}),"undefined"==typeof i.active?i.active=h:i.isSelected(h.model)&&i.isSelected(i.active.model)===!1&&(i.active=h),a.$watch(function(){return i.isSelected(h.model)},function(a){a?b.addClass(d,l):b.removeClass(d,l)}),a.$watch(function(){return i.active===h},function(a){a?(d.attr("tabindex",0),b.addClass(d,m)):(b.removeClass(d,m),j?d.attr("tabindex",-1):d.removeAttr("tabindex"))});var n={37:"left",38:"up",39:"right",40:"down"};d.on("keydown",function(b){var c=!1,f=!1;if(b.which>=37&&b.which<=40){var j=i._getSiblingItems(h),k=d[0].getBoundingClientRect();if(j.previous&&g(n[b.which],k,j.previous.element[0].getBoundingClientRect())&&(i.activate(j.previous),c=!0),j.next&&g(n[b.which],k,j.next.element[0].getBoundingClientRect())&&(i.activate(j.next),c=!0),!(c!==!1||j.next&&j.previous)){var l=b.which,m=!1;b.which<=38?l+=2:l-=2,j.next&&g(n[l],k,j.next.element[0].getBoundingClientRect())&&(i.cyclic?(i.activate(i._last()),c=!0):m="kbReachedBegin"),j.previous&&g(n[l],k,j.previous.element[0].getBoundingClientRect())&&(i.cyclic?(i.activate(i._first()),c=!0):m="kbReachedEnd"),m&&i.attrs[m]&&angular.element(i._element).scope().$eval(i.attrs[m],{$event:b})}c&&b.preventDefault()}else 32===b.which?(b.preventDefault(),f=!0):13===b.which&&(f=!0);(c||f)&&(f&&(i.invoke(h),e.kbInvoke&&a.$eval(e.kbInvoke,{$event:b})),a.$apply())}),d.on("click",function(b){i.activate(h),i.invoke(h),e.kbInvoke&&a.$eval(e.kbInvoke,{$event:b}),a.$apply()}),a.$on("$destroy",function(){i.active=i._first()})}}}]),angular.module("keyboard").directive("kbList",["KbContainerController","kbScroll",function(a,b){return{controller:a,require:["kbList","?ngModel"],link:function(a,c,d,e){var f=e[0];f.initialize({identifier:"[kb-list]",ngModel:e[1],attrs:d,activate:function(a){this.active=a,this.select(a.model),b.focus(a.element[0])},invoke:function(){return!1}})}}}]),angular.module("keyboard").directive("kbSelect",["KbContainerController","kbScroll",function(a,b){return{controller:a,require:["kbSelect","ngModel"],link:function(a,c,d,e){var f=e[0];f.initialize({identifier:"[kb-select]",ngModel:e[1],attrs:d,activate:function(a){this.active=a,b.focus(a.element[0])},invoke:function(a){return this.toggle(a.model),!0}})}}}]),angular.module("keyboard.focus").factory("kbFocus",["$log",function(a){var b="",c=function d(a){return 0===arguments.length?b:void d.set(a)};return c.get=function(){return b},c.set=function(c){"string"==typeof c?b=c:a.error("[kbFocus] label must be a string, got",c)},c.reset=function(){b=""},c}]),angular.module("keyboard").service("kbScroll",["$window",function(a){var b="BODY";navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(b="HTML");var c=this;this.change=function(a,b,c,d){if(d&&angular.element.prototype.animate){var e=angular.element(a),f={};return f[b]=c,e.animate(f,d),function(){e.stop(!0,!0)}}return a[b]=c,angular.noop},this.getScrollParent=function(a){for(var c=a.parentElement;c.nodeName!==b;){var d=getComputedStyle(c),e=d.overflow+d.overflowX+d.overflowY;if(e.match(/scroll|hidden/))break;c=c.parentElement}return c},this.to=function(d,e,f){var g=angular.noop,h=c.getScrollParent(d),i=d.getBoundingClientRect(),j={top:Math.ceil(i.top),right:Math.ceil(i.right),bottom:Math.ceil(i.bottom),left:Math.ceil(i.left)};if(h.nodeName===b)var k={top:0,right:a.innerWidth,bottom:a.innerHeight,left:0};else var l=h.getBoundingClientRect(),k={top:Math.ceil(l.top),right:Math.ceil(l.right),bottom:Math.ceil(l.bottom),left:Math.ceil(l.left)};var m=j.top-k.top,n=k.right-j.right,o=k.bottom-j.bottom,p=j.left-k.left;if(m+e.top<0?(g=c.change(h,"scrollTop",h.scrollTop+m+e.top,f),o+=m,m=0):o+e.bottom<0&&(g=c.change(h,"scrollTop",h.scrollTop-o+e.bottom,f),m+=o,o=0),p+e.left<0?(g=c.change(h,"scrollLeft",h.scrollLeft+p+e.left,f),n+=p,p=0):n+e.right<0&&(g=c.change(h,"scrollLeft",h.scrollLeft-n+e.right,f),p+=n,n=0),h.nodeName===b)return g;var q=c.to(h,{top:m,right:m,bottom:o,left:p},f);return function(){g(),q()}};var d=angular.noop;this.focus=function(a){d();var b=this.getScrollParent(a),c={top:b.scrollTop,left:b.scrollLeft};a.hasAttribute("tabindex")||a.setAttribute("tabindex",0),a.focus(),b.scrollTop===c.top&&b.scrollLeft===c.left||(b.scrollTop=c.top,b.scrollLeft=c.left,d=this.to(a,{top:0,right:0,bottom:0,left:0},200))}}]),angular.module("artTypeahead",["keyboard"]),angular.module("artTypeahead").directive("artTypeahead",["$parse","$document","$http","$timeout","$compile",function(){return{restrict:"E",scope:{levels:"=artLevels",callOutside:"&artTrigger",source:"=artSource",pagination:"@artPagination",minQuery:"@artMinQuery",maxResults:"@artMaxResults"},transclude:!1,templateUrl:"angular-hierarchical-typeahead.html",controller:function(a,b){a.loading=!1,a.query=null,a.lastLevel=!1,a.addedElements=!1,a.elementsAdded=0,a.tooMany=!1;var c={maxResults:200,dblClickTime:400,minQuery:2,defaultLevels:[{name:"Level1",icon:"fa fa-users",color:"#3f3f3f",bColor:"#a6b5bd"},{name:"Level2",icon:"fa fa-building-o",color:"#3f3f3f",bColor:"#c5d7e0"},{name:"Level3",icon:"fa fa-tachometer",color:"#3f3f3f",bColor:"#e8eff3"}]};a.currentPlaceholder=a.levels[0].name,a.minQuery&&(c.minQuery=parseInt(a.minQuery)),a.maxResults&&(c.maxResults=parseInt(a.maxResults)),a.whichLevel=function(){var b=a.levelsActive.length-1;return a.levelsActive.forEach(function(a,c){a.isVisible&&!a.activeName&&(b=c)}),b};var d=0;a.selectItem=function(b,f,g){var h=function(a,b){return b-a<c.dblClickTime?!0:!1},i=a.whichLevel();13===g.keyCode||h(d,g.timeStamp)?(a.levelsActive[i].activeName=b.name,a.levelsActive[i+1]&&(a.levelsActive[i+1].activeId=b.id),a.levelsActive[i].isActive=!0,a.query=null,i<a.levelsActive.length-1?(a.levelsActive[i+1].isVisible=!0,a.currentPlaceholder=a.levels[i+1].name,e(!1),a.focusOnSearch()):parseInt(i)===a.levelsActive.length-1&&(a.lastLevel=!0,a.callOutside({id:b.id,type:a.levels[i].name}))):32!==g.keyCode&&h(d,g.timeStamp)||(i<a.levelsActive.length-1?a.callOutside({id:b.id,type:a.levels[i].name}):parseInt(i)===a.levelsActive.length-1&&(a.callOutside({id:b.id,type:a.levels[i].name}),a.lastLevel=!0,a.query=null,a.levelsActive[i].activeName=b.name,a.levelsActive[i+1]&&(a.levelsActive[i+1].activeId=b.id),a.levelsActive[i].isActive=!0)),d=g.timeStamp},a.actionLevel=function(b,c,d){if(!b.activeName&&!d)return!1;var f=a.whichLevel();if(f>c)for(var g=c;g<a.levelsActive.length;g++)a.levelsActive[g].activeName=!1,a.levelsActive[g].isActive=!1,a.levelsActive[g].isVisible=!1;b.activeName=!1,b.isActive=!0,b.isVisible=!0,a.lastLevel=!1,a.currentPlaceholder=b.name,e(!1),a.focusOnSearch(),d&&a.$apply()};var e=function(d,e){a.loading=!0,e||(a.results=!1);var f=a.whichLevel();a.source(a.levels[f].name,d,e,a.levelsActive[f].activeId).then(function(d){a.tooMany=!1,d.length>0?e?(a.results=a.results.concat(d),a.addedElements=!0,a.elementsAdded=d.length,b(function(){a.addedElements=!1},700),a.results.length>c.maxResults&&(a.tooMany=!0,a.results=!1)):(a.results=d,a.callOutside({id:d[0].id,type:a.levels[f].name}),a.levels[f].dataSet=d):e||(a.results=!1),a.loading=!1},function(b){a.results=!1,a.loading=!1})};a.getOutsideData=e,a.$watch("query",function(b){if(b&&b.length>c.minQuery){e(b);var d=a.whichLevel();a.levelsActive[d].activeName=!1}else b&&b.length<=c.minQuery&&e(!1)}),a.hideInput=function(b){return b&&!a.query?{flex:0,width:"0px",opacity:0}:{flex:1,width:"initial",opacity:1}},a.levelsActive=angular.copy(a.levels),a.levelsActive=a.levelsActive.map(function(a){return{name:a.name,icon:a.icon,color:a.color,bColor:a.bColor,isActive:!1,isVisible:!1,activeName:!1,activeId:!1}}),a.levelsActive[0].isVisible=!0,e(!1)},link:function(a,b,c){var d=function(a){console.log("transitioning element",a);var b=a.style.width;a.style.width="auto";var c=getComputedStyle(a).width;a.style.width=b,a.offsetWidth,a.style.transition="width .5s ease-in-out",a.style.width=c,a.addEventListener("transitionend",function d(b){"width"===b.propertyName&&(a.style.transition="",a.style.width="auto",a.removeEventListener("transitionend",d,!1))},!1)};a.transitElement=function(a){var c=angular.element(b[0].querySelector(".levels"))[a];d(c)},b[0].querySelector(".levels.search-bar").addEventListener("keydown",function(c){if(40===c.keyCode&&a.results&&(c.stopPropagation(),c.preventDefault(),b[0].querySelectorAll(".art-results li")[1].click()),8===c.keyCode&&!a.query){console.log("Fire back event");var d=a.whichLevel();d>0&&a.actionLevel(a.levelsActive[d-1],d-1,!0)}},!1),a.focusOnSearch=function(a){a?a.keyCode&&13!==a.keyCode&&32!==a.keyCode&&38!==a.keyCode&&40!==a.keyCode&&(console.log(a.keyCode),b[0].querySelector(".search-bar").focus()):b[0].querySelector(".search-bar").focus()}}}}]),angular.module("artTypeahead").run(["$templateCache",function(a){a.put("angular-hierarchical-typeahead.html",'<div class="art-typeahead-container">\n    <div class="art-search">\n        <div class="levels"\n             ng-repeat="level in levelsActive track by $index"\n             ng-if="level.isVisible"\n             ng-class="{active: level.isActive}"\n             ng-click="actionLevel(level, $index)"\n             style="background-color: {{level.bColor}}; border-color: {{level.bColor}}"\n        >\n            <i style="color: {{level.color}}" class="{{level.icon}}" aria-hidden="true"></i> {{level.activeName || level.name}}\n        </div>\n        <span class="text-clone"></span>\n        <input ng-style="hideInput(lastLevel)" type="text" ng-model="query" ng-model-options="{ debounce: 500 }" class="levels search-bar" placeholder="Search for {{currentPlaceholder}}" autofocus>\n    </div>\n    <div class="art-loader" ng-if="loading">\n        <svg class="art-circular" viewBox="25 25 50 50">\n            <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/>\n        </svg>\n    </div>\n    <div class="art-results" ng-class="{\'loading\': loading}">\n        <ul kb-list ng-if="results">\n            <li ng-repeat="item in results" kb-item kb-invoke="selectItem(item, $index, $event)" ng-keydown="focusOnSearch($event)">\n                {{item.name}}\n            </li>\n            <li ng-if="pagination" class="load-more" ng-click="getOutsideData(false, true)">\n                <i class="fa fa-plus" aria-hidden="true"></i> Load More\n            </li>\n        </ul>\n        <ul>\n            <li ng-if="!results && !loading && !tooMany">\n                <i class="fa fa-ban" aria-hidden="true"></i> No results.\n            </li>\n\n            <li ng-if="!results && !loading && tooMany">\n                <i class="fa fa-ban" aria-hidden="true"></i> Too many results, please use the search function.\n            </li>\n        </ul>\n    </div>\n    <div class="art-elements-added" ng-if="pagination && addedElements"> <!--&& addedElements-->\n        <i class="fa fa-plus" aria-hidden="true"></i>{{elementsAdded}}\n    </div>\n\n    <div style="text-align: right; clear: both" class="art-tooltip-helper" ng-click="showTooltip = !showTooltip">\n        <i class="fa fa-question-circle" aria-hidden="true"></i>\n        <small ng-if="results && showTooltip" class="art-tooltip">\n\n            <table class="table table-bordered" style="width: 50%; float: right">\n                <thead>\n                <tr>\n                    <th>Action</th>\n                    <th>Description</th>\n                </tr>\n                </thead>\n                <tbody>\n                <tr>\n                    <td><i class="fa fa-arrow-down" aria-hidden="true"></i> & <i class="fa fa-arrow-up" aria-hidden="true"></i></td>\n                    <td valign="middle">Move up and down on the list with keyboard arrows</td>\n                </tr>\n                <tr>\n                    <td><i class="fa fa-mouse-pointer" aria-hidden="true"></i> CLICK</td>\n                    <td rowspan="2" valign="middle">Load the {{currentPlaceholder}} into view</td>\n                </tr>\n                <tr>\n                    <td><i class="fa fa-keyboard-o" aria-hidden="true"></i> SPACE</td>\n                </tr>\n                <tr>\n                    <td><i class="fa fa-mouse-pointer" aria-hidden="true"></i> + <i class="fa fa-mouse-pointer" aria-hidden="true"></i> DOUBLE-CLICK</td>\n                    <td rowspan="2" valign="middle">Open the {{currentPlaceholder}} in a new Level</td>\n                </tr>\n                <tr>\n                    <td><i class="fa fa-keyboard-o" aria-hidden="true"></i> ENTER</td>\n                </tr>\n                <tr>\n                    <td><i class="fa fa-keyboard-o" aria-hidden="true"></i> BACKSPACE</td>\n                    <td valign="middle">Go back one level</td>\n                </tr>\n                <tr>\n                    <td><i class="fa fa-mouse-pointer" aria-hidden="true"></i> CLICK on a Level</td>\n                    <td valign="middle">Go back to the clicked Level</td>\n                </tr>\n                <tr>\n                    <td><i class="fa fa-keyboard-o" aria-hidden="true"></i> ANY KEY</td>\n                    <td valign="middle">While on the {{currentPlaceholder}} list any key you press will focus the search input and make a new search.</td>\n                </tr>\n                </tbody>\n            </table>\n        </small>\n    </div>\n\n\n\n</div>')}]);